define(["jquery","core/ajax","core/str","core/config","core/notification","core/log"],function(a,b,c,d,e,f){return{setup:function(b){var g=function(a,b,c){var e=window.location.href.match(/(^[^#]*)/)[0],f=e+"&action="+a+"&questionid="+b+"&sesskey="+d.sesskey;return'<a href="'+f+'" data-action="'+a+'" data-questionid="'+b+'">'+c+"</a> "},h=function(b,c,d){var e=/^(fitem|fgroup)_id_question(\d+)(_label)?$/g,f=e.exec(b.attr("id")),h=parseInt(f[2]),i=a('<div class="editcontrols" data-questionid="'+h+'"></div>');h?(c||i.append(g("moveup",h,"up")),d||i.append(g("movedown",h,"down")),i.append(g("add",h,"insert")),i.append(g("edit",h,"edit")),i.append(g("duplicate",h,"duplicate")),i.append(g("delete",h,"delete"))):i.append(g("add",h,"add question")),b.append(i)},i="form.mform.mod-recommend-recommendation.editing",j=a(i+" .fitem"),k=j.length;j.each(function(b){h(a(this),0===b,b===k-1)});var l=a('<div class="fitem dummyitem" id="fitem_id_question0">&nbsp;<br>&nbsp;<br></div>');a(i).append(l),h(l),a("body").on("click",i+" .editcontrols a[data-action=add]",function(d){d.preventDefault();var e=a(this).attr("href");c.get_strings([{key:"addquestion",component:"mod_recommend"},{key:"selectquestiontype",component:"mod_recommend"},{key:"cancel"}]).done(function(c){var d=a('<div><div id="mod_recommend_type_selector"><p class="selecttype"></p><ul class="typeslist"></ul><p><input type="button" id="type_selector_cancel"/></p></div></div>');d.find(".selecttype").html(c[1]),d.find("#type_selector_cancel").attr("value",c[2]);for(var g in b){var h=a("<li><a></a></li>");h.find("a").attr("href",e+"&type="+g).html(b[g]),d.find(".typeslist").append(h)}var i=new M.core.dialogue({draggable:!0,modal:!0,closeButton:!0,headerContent:c[0],bodyContent:d.html()});i.show(),a("#mod_recommend_type_selector #type_selector_cancel").on("click",function(){f.debug("click on cancel"),i.destroy()})})}),a("body").on("click",i+" .editcontrols a[data-action=delete]",function(b){b.preventDefault();var d=a(this).attr("href");c.get_strings([{key:"delete"},{key:"suredeletequestion",component:"mod_recommend"},{key:"yes"},{key:"no"}]).done(function(a){e.confirm(a[0],a[1],a[2],a[3],function(){window.location.href=d})})})}}});